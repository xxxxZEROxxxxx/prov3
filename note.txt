// js/scripts.js

// تسجيل حساب جديد
function registerUser(name, email, password) {
    let users = JSON.parse(localStorage.getItem('users')) || [];

    // التحقق مما إذا كان البريد الإلكتروني مسجلاً بالفعل
    const userExists = users.some(user => user.email === email);
    if(userExists){
        alert("البريد الإلكتروني مستخدم بالفعل. يرجى استخدام بريد إلكتروني آخر.");
        return false;
    }

    // إضافة المستخدم الجديد إلى قائمة المستخدمين
    users.push({ name, email, password });
    localStorage.setItem('users', JSON.stringify(users));
    alert("تم تسجيل حسابك بنجاح!");
    return true;
}

// تسجيل الدخول
function loginUser(email, password) {
    let users = JSON.parse(localStorage.getItem('users')) || [];

    // البحث عن المستخدم بالبيانات المدخلة
    const user = users.find(user => user.email === email && user.password === password);
    if(user){
        // تخزين حالة تسجيل الدخول
        localStorage.setItem('currentUser', JSON.stringify(user));
        alert(`مرحبًا، ${user.name}! تم تسجيل دخولك بنجاح.`);
        window.location.href = 'index.html'; // إعادة التوجيه إلى الصفحة الرئيسية
        return true;
    } else {
        alert("البريد الإلكتروني أو كلمة المرور غير صحيحة.");
        return false;
    }
}

// تسجيل الخروج
function logoutUser() {
    localStorage.removeItem('currentUser');
    alert("تم تسجيل خروجك بنجاح.");
    window.location.href = 'index.html';
}

// تحديث شريط التنقل بناءً على حالة تسجيل الدخول
function updateNavbar() {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    const navLinks = document.querySelector('.navbar-nav');

    if(currentUser){
        navLinks.innerHTML = `
            <li class="nav-item"><a class="nav-link" href="index.html">الرئيسية</a></li>
            <li class="nav-item"><a class="nav-link" href="about.html">عن الموقع</a></li>
            <li class="nav-item"><a class="nav-link" href="products.html">المنتجات</a></li>
            <li class="nav-item"><a class="nav-link" href="blog.html">مدونة</a></li>
            <li class="nav-item"><a class="nav-link" href="gallery.html">معرض الصور</a></li>
            <li class="nav-item"><a class="nav-link" href="contact.html">تواصل معنا</a></li>
            <li class="nav-item"><a class="nav-link" href="logout.html">تسجيل الخروج</a></li>
        `;
    } else {
        navLinks.innerHTML = `
            <li class="nav-item"><a class="nav-link" href="index.html">الرئيسية</a></li>
            <li class="nav-item"><a class="nav-link" href="about.html">عن الموقع</a></li>
            <li class="nav-item"><a class="nav-link" href="products.html">المنتجات</a></li>
            <li class="nav-item"><a class="nav-link" href="blog.html">مدونة</a></li>
            <li class="nav-item"><a class="nav-link" href="gallery.html">معرض الصور</a></li>
            <li class="nav-item"><a class="nav-link" href="contact.html">تواصل معنا</a></li>
            <li class="nav-item"><a class="nav-link" href="login.html">تسجيل الدخول</a></li>
        `;
    }
}

// وظيفة التبديل بين الوضع الداكن والفاتح
function toggleTheme() {
    document.body.classList.toggle('dark-mode');
    const isDarkMode = document.body.classList.contains('dark-mode');
    // تغيير أيقونة الزر بناءً على الوضع
    const themeToggleBtn = document.getElementById('themeToggle');
    if(isDarkMode){
        themeToggleBtn.innerHTML = `<i class="bi bi-sun-fill"></i> Light`;
    } else {
        themeToggleBtn.innerHTML = `<i class="bi bi-moon-fill"></i> Dark`;
    }
    // حفظ الوضع في localStorage
    localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
}

// تطبيق الوضع المحفوظ عند تحميل الصفحة
function applySavedTheme() {
    const savedTheme = localStorage.getItem('theme');
    if(savedTheme === 'dark'){
        document.body.classList.add('dark-mode');
        const themeToggleBtn = document.getElementById('themeToggle');
        if(themeToggleBtn){
            themeToggleBtn.innerHTML = `<i class="bi bi-sun-fill"></i> Light`;
        }
    } else {
        document.body.classList.remove('dark-mode');
        const themeToggleBtn = document.getElementById('themeToggle');
        if(themeToggleBtn){
            themeToggleBtn.innerHTML = `<i class="bi bi-moon-fill"></i> Dark`;
        }
    }
}

// التحقق من صحة نموذج الاتصال
function validateContactForm() {
    const name = document.getElementById('contactName').value.trim();
    const email = document.getElementById('contactEmail').value.trim();
    const message = document.getElementById('contactMessage').value.trim();

    if (name === "" || email === "" || message === "") {
        alert("يرجى ملء جميع الحقول.");
        return false;
    }

    // التحقق من صحة البريد الإلكتروني
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailPattern.test(email)) {
        alert("يرجى إدخال بريد إلكتروني صحيح.");
        return false;
    }

    alert("تم إرسال رسالتك بنجاح!");
    return true;
}

// التحقق من نموذج تسجيل الدخول
function validateLoginForm(event) {
    event.preventDefault();
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value.trim();
    if (email === "" || password === "") {
        alert("يرجى ملء جميع الحقول.");
        return false;
    }
    loginUser(email, password);
}

// التحقق من نموذج التسجيل
function validateRegisterForm(event) {
    event.preventDefault();
    const name = document.getElementById('registerName').value.trim();
    const email = document.getElementById('registerEmail').value.trim();
    const password = document.getElementById('registerPassword').value.trim();
    const confirmPassword = document.getElementById('registerConfirmPassword').value.trim();

    if (name === "" || email === "" || password === "" || confirmPassword === "") {
        alert("يرجى ملء جميع الحقول.");
        return false;
    }

    if (password !== confirmPassword) {
        alert("كلمة المرور وتأكيدها غير متطابقتين.");
        return false;
    }

    // التحقق من صحة البريد الإلكتروني
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailPattern.test(email)) {
        alert("يرجى إدخال بريد إلكتروني صحيح.");
        return false;
    }

    // تسجيل المستخدم
    const success = registerUser(name, email, password);
    if(success){
        window.location.href = 'login.html'; // إعادة التوجيه إلى صفحة تسجيل الدخول
    }
}

// إضافة مستمع للأحداث عند تحميل المحتوى
document.addEventListener('DOMContentLoaded', () => {
    // تطبيق الوضع المحفوظ
    applySavedTheme();

    // تحديث شريط التنقل بناءً على حالة تسجيل الدخول
    updateNavbar();

    // إضافة مستمع لنموذج الاتصال
    const contactForm = document.getElementById('contactForm');
    if(contactForm){
        contactForm.addEventListener('submit', function(event){
            if(!validateContactForm()){
                event.preventDefault();
            }
        });
    }

    // إضافة مستمع لنموذج تسجيل الدخول
    const loginForm = document.getElementById('loginForm');
    if(loginForm){
        loginForm.addEventListener('submit', validateLoginForm);
    }

    // إضافة مستمع لنموذج التسجيل
    const registerForm = document.getElementById('registerForm');
    if(registerForm){
        registerForm.addEventListener('submit', validateRegisterForm);
    }

    // إضافة مستمع لزر التبديل بين الوضع الداكن والفاتح
    const themeToggleBtn = document.getElementById('themeToggle');
    if(themeToggleBtn){
        themeToggleBtn.addEventListener('click', toggleTheme);
    }
});
// js/scripts.js

// تسجيل حساب جديد
function registerUser(name, email, password) {
    let users = JSON.parse(localStorage.getItem('users')) || [];

    // التحقق مما إذا كان البريد الإلكتروني مسجلاً بالفعل
    const userExists = users.some(user => user.email === email);
    if(userExists){
        alert("البريد الإلكتروني مستخدم بالفعل. يرجى استخدام بريد إلكتروني آخر.");
        return false;
    }

    // إضافة المستخدم الجديد إلى قائمة المستخدمين
    users.push({ name, email, password });
    localStorage.setItem('users', JSON.stringify(users));
    alert("تم تسجيل حسابك بنجاح!");
    return true;
}

// تسجيل الدخول
function loginUser(email, password) {
    let users = JSON.parse(localStorage.getItem('users')) || [];

    // البحث عن المستخدم بالبيانات المدخلة
    const user = users.find(user => user.email === email && user.password === password);
    if(user){
        // تخزين حالة تسجيل الدخول
        localStorage.setItem('currentUser', JSON.stringify(user));
        alert(`مرحبًا، ${user.name}! تم تسجيل دخولك بنجاح.`);
        window.location.href = 'index.html'; // إعادة التوجيه إلى الصفحة الرئيسية
        return true;
    } else {
        alert("البريد الإلكتروني أو كلمة المرور غير صحيحة.");
        return false;
    }
}

// تسجيل الخروج
function logoutUser() {
    localStorage.removeItem('currentUser');
    alert("تم تسجيل خروجك بنجاح.");
    window.location.href = 'index.html';
}

// تحديث شريط التنقل بناءً على حالة تسجيل الدخول
function updateNavbar() {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    const navLinks = document.querySelector('.navbar-nav');

    if(currentUser){
        navLinks.innerHTML = `
            <li class="nav-item"><a class="nav-link" href="index.html">الرئيسية</a></li>
            <li class="nav-item"><a class="nav-link" href="about.html">عن الموقع</a></li>
            <li class="nav-item"><a class="nav-link" href="products.html">المنتجات</a></li>
            <li class="nav-item"><a class="nav-link" href="blog.html">مدونة</a></li>
            <li class="nav-item"><a class="nav-link" href="gallery.html">معرض الصور</a></li>
            <li class="nav-item"><a class="nav-link" href="contact.html">تواصل معنا</a></li>
            <li class="nav-item"><a class="nav-link" href="logout.html">تسجيل الخروج</a></li>
        `;
    } else {
        navLinks.innerHTML = `
            <li class="nav-item"><a class="nav-link" href="index.html">الرئيسية</a></li>
            <li class="nav-item"><a class="nav-link" href="about.html">عن الموقع</a></li>
            <li class="nav-item"><a class="nav-link" href="products.html">المنتجات</a></li>
            <li class="nav-item"><a class="nav-link" href="blog.html">مدونة</a></li>
            <li class="nav-item"><a class="nav-link" href="gallery.html">معرض الصور</a></li>
            <li class="nav-item"><a class="nav-link" href="contact.html">تواصل معنا</a></li>
            <li class="nav-item"><a class="nav-link" href="login.html">تسجيل الدخول</a></li>
        `;
    }
}

// وظيفة التبديل بين الوضع الداكن والفاتح
function toggleTheme() {
    document.body.classList.toggle('dark-mode');
    const isDarkMode = document.body.classList.contains('dark-mode');
    // تغيير أيقونة الزر بناءً على الوضع
    const themeToggleBtn = document.getElementById('themeToggle');
    if(isDarkMode){
        themeToggleBtn.innerHTML = `<i class="bi bi-sun-fill"></i> Light`;
    } else {
        themeToggleBtn.innerHTML = `<i class="bi bi-moon-fill"></i> Dark`;
    }
    // حفظ الوضع في localStorage
    localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
}

// تطبيق الوضع المحفوظ عند تحميل الصفحة
function applySavedTheme() {
    const savedTheme = localStorage.getItem('theme');
    if(savedTheme === 'dark'){
        document.body.classList.add('dark-mode');
        const themeToggleBtn = document.getElementById('themeToggle');
        if(themeToggleBtn){
            themeToggleBtn.innerHTML = `<i class="bi bi-sun-fill"></i> Light`;
        }
    } else {
        document.body.classList.remove('dark-mode');
        const themeToggleBtn = document.getElementById('themeToggle');
        if(themeToggleBtn){
            themeToggleBtn.innerHTML = `<i class="bi bi-moon-fill"></i> Dark`;
        }
    }
}

// التحقق من صحة نموذج الاتصال
function validateContactForm() {
    const name = document.getElementById('contactName').value.trim();
    const email = document.getElementById('contactEmail').value.trim();
    const message = document.getElementById('contactMessage').value.trim();

    if (name === "" || email === "" || message === "") {
        alert("يرجى ملء جميع الحقول.");
        return false;
    }

    // التحقق من صحة البريد الإلكتروني
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailPattern.test(email)) {
        alert("يرجى إدخال بريد إلكتروني صحيح.");
        return false;
    }

    alert("تم إرسال رسالتك بنجاح!");
    return true;
}

// التحقق من نموذج تسجيل الدخول
function validateLoginForm(event) {
    event.preventDefault();
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value.trim();
    if (email === "" || password === "") {
        alert("يرجى ملء جميع الحقول.");
        return false;
    }
    loginUser(email, password);
}

// التحقق من نموذج التسجيل
function validateRegisterForm(event) {
    event.preventDefault();
    const name = document.getElementById('registerName').value.trim();
    const email = document.getElementById('registerEmail').value.trim();
    const password = document.getElementById('registerPassword').value.trim();
    const confirmPassword = document.getElementById('registerConfirmPassword').value.trim();

    if (name === "" || email === "" || password === "" || confirmPassword === "") {
        alert("يرجى ملء جميع الحقول.");
        return false;
    }

    if (password !== confirmPassword) {
        alert("كلمة المرور وتأكيدها غير متطابقتين.");
        return false;
    }

    // التحقق من صحة البريد الإلكتروني
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailPattern.test(email)) {
        alert("يرجى إدخال بريد إلكتروني صحيح.");
        return false;
    }

    // تسجيل المستخدم
    const success = registerUser(name, email, password);
    if(success){
        window.location.href = 'login.html'; // إعادة التوجيه إلى صفحة تسجيل الدخول
    }
}

// إضافة مستمع للأحداث عند تحميل المحتوى
document.addEventListener('DOMContentLoaded', () => {
    // تطبيق الوضع المحفوظ
    applySavedTheme();

    // تحديث شريط التنقل بناءً على حالة تسجيل الدخول
    updateNavbar();

    // إضافة مستمع لنموذج الاتصال
    const contactForm = document.getElementById('contactForm');
    if(contactForm){
        contactForm.addEventListener('submit', function(event){
            if(!validateContactForm()){
                event.preventDefault();
            }
        });
    }

    // إضافة مستمع لنموذج تسجيل الدخول
    const loginForm = document.getElementById('loginForm');
    if(loginForm){
        loginForm.addEventListener('submit', validateLoginForm);
    }

    // إضافة مستمع لنموذج التسجيل
    const registerForm = document.getElementById('registerForm');
    if(registerForm){
        registerForm.addEventListener('submit', validateRegisterForm);
    }

    // إضافة مستمع لزر التبديل بين الوضع الداكن والفاتح
    const themeToggleBtn = document.getElementById('themeToggle');
    if(themeToggleBtn){
        themeToggleBtn.addEventListener('click', toggleTheme);
    }
});
